<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SPRK+ JS Example</title>
</head>
<body>
  <button id="scan">Scan for SK devices</button>
  <pre id="output"></pre>

  <script>
    const button = document.getElementById('scan');
    const output = document.getElementById('output');
    const log = (...args) => output.textContent += args.join(' ') + '\n';

    button.addEventListener('click', async () => {
      output.textContent = '';

      try {
        // üîç Scan for devices starting with "SK"
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'SK' }],
          optionalServices: [
            // Add known services here
            '0000180a-0000-1000-8000-00805f9b34fb', // Device Info
            '22bb746f-2bb0-7554-2d6f-726568705327', // Main Sphero Control
            '22bb746f-2ba0-7554-2d6f-726568705327'  // Async/Commands
          ]
        });

        log(`‚úÖ Found device: ${device.name} (${device.id})`);

        // üîó Connect
        const server = await device.gatt.connect();
        log('Connected to GATT server');

        // Example: read Device Info (manufacturer)
        const infoService = await server.getPrimaryService('0000180a-0000-1000-8000-00805f9b34fb');
        const manufChar = await infoService.getCharacteristic('00002a29-0000-1000-8000-00805f9b34fb');
        const value = await manufChar.readValue();
        const decoder = new TextDecoder('utf-8');
        log('Manufacturer:', decoder.decode(value));

        // Example: read battery (custom)
        const controlService = await server.getPrimaryService('22bb746f-2bb0-7554-2d6f-726568705327');
        const batteryChar = await controlService.getCharacteristic('22bb746f-2bb8-7554-2d6f-726568705327');
        const battVal = await batteryChar.readValue();
        log('Battery %:', battVal.getUint8(0));

      } catch (err) {
        log('‚ùå Error:', err);
      }
    });
  </script>
</body>
</html>
