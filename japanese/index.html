<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="stylesheet" href="../assets/layout/css/cosmuic.css">
<link rel="stylesheet" href="../assets/layout/css/style-book.css">
<script src="../assets/layout/layout.js"></script>
<title>Japanese Study Book</title>
<style>
@page { margin: 0 }
html,body { height: 100%; margin: 0; overflow: hidden; }

main {
  box-sizing: border-box;
  padding: 0;
  height: calc(100vh - 64px);
  display: flex;
  justify-content: center;
  align-items: center;
  background: #e0e0e0;
  overflow: hidden;
}

body {
  --header-h: 64px;
  --scale: min(
    calc(100vw / var(--paper-width)),
    calc((100vh - var(--header-h)) / var(--paper-height))
  );

  background: linear-gradient(
    to bottom,
    #ffffff 0,
    #ffffff 64px,
    #e0e0e0 64px,
    #e0e0e0 100%
  );
}

body.A3               { --paper-width: 297mm; --paper-height: 419mm; }
body.A3.landscape     { --paper-width: 420mm; --paper-height: 296mm; }
body.A4               { --paper-width: 210mm; --paper-height: 296mm; }
body.A4.landscape     { --paper-width: 297mm; --paper-height: 209mm; }
body.A5               { --paper-width: 148mm; --paper-height: 209mm; }
body.A5.landscape     { --paper-width: 210mm; --paper-height: 147mm; }
body.letter           { --paper-width: 216mm; --paper-height: 279mm; }
body.letter.landscape { --paper-width: 280mm; --paper-height: 215mm; }
body.legal            { --paper-width: 216mm; --paper-height: 356mm; }
body.legal.landscape  { --paper-width: 357mm; --paper-height: 215mm; }

.frame {
  width: calc(var(--paper-width) * var(--scale));
  height: calc(var(--paper-height) * var(--scale));
  display: inline-block;
  position: relative;
  box-sizing: content-box;
  overflow: hidden;
}

.sheet {
  width: var(--paper-width);
  height: var(--paper-height);
  transform: scale(var(--scale));
  transform-origin: top left;

  box-sizing: border-box;
  background: white;
  box-shadow: 0 .5mm 2mm rgba(0, 0, 0, .3);
  display: block;
  position: relative;
}

#page-selector {
  position: absolute;
  width: max(33vw, 225px);
  max-width: calc(100vw - 75px);
  z-index: 11999;
  height: 40px;
  margin: 11px;
  top: 0;
  right: 0;
  background-color: transparent;
  align-items: center;
  padding: 0 10px;
}

body > header > span a {
  display: none;
}

select, ::picker(select) {
  appearance: base-select;
  height: 80vh;
}

select option {
  height: 4rem;
  padding-left: 1rem;
}

@media print {
  header { display: none; opacity: 0;}
  #page-selector { display: none; }
  body { background: linear-gradient(to bottom, #ffffff 0, #ffffff 100%); }
  body > header ~ main { position:absolute; padding: 0; width: var(--paper-width) !important; height: var(--paper-height) !important; top: 0; background: white !important; }
  .frame { width: var(--paper-width) !important; height: var(--paper-height) !important; }
  .sheet {
    position: static;
    transform: none !important;
    box-shadow: none;
    page-break-after: always;
    overflow: hidden;
    scale: 1 !important;
    width: var(--paper-width) !important; height: var(--paper-height) !important;
  }
}
</style>
</head>
<body class="A5">

<header></header>

<select id="page-selector">
  <option value="cover-front" selected>Cover (Front)</option>
  <option value="kanachart"          >Hiragana &amp; Katakana</option>
  <option value="toc"                >Table of Contents</option>
  <option value="template-even"      >Blank</option>
  <option value="body001"            >Body 1</option>
  <option value="body002"            >Body 2</option>
  <option value="jlpt-n5-vocab001"   >JLPT N5 - Vocab. 1</option>
  <option value="jlpt-n5-vocab002"   >JLPT N5 - Vocab. 2</option>
  <option value="jlpt-n5-vocab003"   >JLPT N5 - Vocab. 3</option>
  <option value="jlpt-n5-vocab004"   >JLPT N5 - Vocab. 4</option>
  <option value="jlpt-n5-vocab005"   >JLPT N5 - Vocab. 5</option>
  <option value="jlpt-n5-vocab006"   >JLPT N5 - Vocab. 6</option>
  <option value="jlpt-n5-vocab007"   >JLPT N5 - Vocab. 7</option>
  <option value="jlpt-n5-vocab008"   >JLPT N5 - Vocab. 8</option>
  <option value="jlpt-n5-vocab009"   >JLPT N5 - Vocab. 9</option>
  <option value="template-even"      >JLPT N5 - blank</option>
  <option value="jlpt-n4-vocab001"   >JLPT N4 - Vocab. 1</option>
  <option value="jlpt-n4-vocab002"   >JLPT N4 - Vocab. 2</option>
  <option value="jlpt-n4-vocab003"   >JLPT N4 - Vocab. 3</option>
  <option value="jlpt-n4-vocab004"   >JLPT N4 - Vocab. 4</option>
  <option value="jlpt-n4-vocab005"   >JLPT N4 - Vocab. 5</option>
  <option value="jlpt-n4-vocab006"   >JLPT N4 - Vocab. 6</option>
  <option value="jlpt-n4-vocab007"   >JLPT N4 - Vocab. 7</option>
  <option value="jlpt-n4-vocab008"   >JLPT N4 - Vocab. 8</option>
  <option value="jlpt-n4-vocab009"   >JLPT N4 - Vocab. 9</option>
  <option value="template-even"      >JLPT N5 - blank</option>
  <option value="cover-back_(inside)">Cover (Back Inside)</option>
  <option value="cover-back"         >Cover (Back)</option>
</select>

<main>
  <div class="frame">
    <iframe class="sheet" src="" frameborder="0"></iframe>
  </div>
</main>

<script>
const select = document.getElementById("page-selector");
const iframe = document.querySelector("iframe.sheet");
const frame  = document.querySelector(".frame");

const MM_TO_PX = 96 / 25.4;

function isFirefox() {
  return CSS.supports("-moz-appearance: none");
}

function updateIframe() {
  iframe.src = select.value + ".html";
}

function resizeForFirefox() {
  if (!isFirefox()) return;

  const bodyStyles = getComputedStyle(document.body);

  const paperWmm = parseFloat(bodyStyles.getPropertyValue("--paper-width"));
  const paperHmm = parseFloat(bodyStyles.getPropertyValue("--paper-height"));
  const headerH  = 64;

  const vw = window.innerWidth;
  const vh = window.innerHeight - headerH;

  const paperWpx = paperWmm * MM_TO_PX;
  const paperHpx = paperHmm * MM_TO_PX;

  const scale = Math.min(vw / paperWpx, vh / paperHpx);

  const scaledW = paperWpx * scale;
  const scaledH = paperHpx * scale;

  frame.style.width  = scaledW + "px";
  frame.style.height = scaledH + "px";

  iframe.style.scale  = scale;
}

iframe.addEventListener("load", resizeForFirefox);
window.addEventListener("resize", resizeForFirefox);

updateIframe();
select.addEventListener("change", updateIframe);

</script>



</body>
</html>
