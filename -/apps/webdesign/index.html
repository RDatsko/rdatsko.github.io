<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/layout/css/cosmuic.css">
<link rel="stylesheet" href="/layout/css/styles.css">
<link rel="stylesheet" href="editor.css">
<title>Mystic's Web: Page Builder</title>
<style>
body {
    margin: 0;
    font-family: sans-serif;
    display: flex;
    height: 100vh;
    overflow: hidden;
}

main.app {
    height: calc(100vh - 64px);
    display: flex;
    width: 100vw;
    max-width: 100vw;
}

#sidebar {
    width: 200px;
    background: #f0f0f0;
    padding: 10px;
    box-sizing: border-box;
    border-left: 1px solid #ccc;
    display: flex;
    flex-direction: column;
}

#toolbar {
    margin: 10px;
    display: flex;
    flex-direction: row;
    gap: 6px;
    justify-content: center;
}

#toolbar button {
    padding: 6px;
    border: 1px solid #aaa;
    background: #fff;
    color: black;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.2s;
    line-height: 1rem;
    margin: 0;
    min-width: 2.25rem;
    max-width: 2.25rem;
}

#toolbar button.active {
    background: #007bff;
    color: white;
    border-color: #007bff;
}

#canvas-wrap {
    flex: 1;
    background: #eee;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    overflow: auto;
}

#canvas {
    background: #fff;
    padding: 20px;
    box-sizing: border-box;
    overflow-y: auto;
    border: 1px solid #ccc;
    border-radius: 8px;
    transition: width 0.3s;
    display: flex;
    flex-direction: column;
}

.desktop #canvas { width: 1200px; }
.tablet #canvas { width: 768px; }
.mobile #canvas { width: 375px; }

.draggable {
    display: block;
    padding: 8px;
    background: #ddd;
    margin-bottom: 8px;
    cursor: grab;
    border-radius: 4px;
    text-align: center;

    user-select: none;
    width: 100%;
    min-width: 45px;
    padding: .5em;
    box-sizing: border-box;
    /* min-height: 90px; */
    cursor: all-scroll;
    font-size: 11px;
    font-weight: lighter;
    text-align: center;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    border: 1px solid rgba(0, 0, 0, .2);
    border-radius: 3px;
    margin: 10px 2.5% 5px;
    box-shadow: 0 1px 0 0 rgba(0, 0, 0, .15);
    transition: all .2s ease 0s;
    transition-property: box-shadow, color;
}

.draggable > svg {
    width: 24px;
    height: 24px;
}

.draggable > div {
    display: flex;
    flex: 1 1 0;
    padding-left: .5rem;
    align-items: center;
}

.drop-zone {
    min-height: 20px;
    border: 1px dashed #ccc;
    padding: 5px;
    margin: 5px 0;
    border-radius: 5px;
    transition: background 0.2s, border-color 0.2s;
}

.drop-zone.hover {
    border-color: #666;
    background: #f8f8f8;
}

.element {
    padding: 10px;
    background: #e8e8ff;
    margin: 5px 0;
    border-radius: 5px;
    position: relative;
    cursor: grab;
    display: block;
}

.element button.remove-btn {
    all: unset;
    position: absolute;
    top: 4px;
    right: 4px;
    background: #ff4d4d;
    color: white;
    border: none;
    border-radius: 3px;
    font-size: 12px;
    padding: 2px 5px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.2s;
}

.element:hover button.remove-btn {
    opacity: 1;
}

.insert-marker {
    height: 4px;
    background: #007bff;
    border-radius: 2px;
    margin: 2px 0;
    transition: opacity 0.2s;
}

.placeholder {
    border: 2px dashed #007bff;
    margin: 5px 0;
    height: 20px;
    border-radius: 5px;
    /* background: repeating-linear-gradient(45deg, #007bff22, #007bff22 10px, #fff 10px, #fff 20px); */
}

#components, #elements {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    /* overflow-y: auto; */
    overflow: hidden auto;
}

#preview-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    max-width: calc(100vw - 200px);
}

</style>
</head>
<body class="desktop">

<header>
<iframe src="/layout/header.html" onload="this.insertAdjacentHTML('afterend', (this.contentDocument.body||this.contentDocument).innerHTML);this.remove()"></iframe>
</header>

<main class="app">
    <div id="preview-area">
        <div id="toolbar">
            <button id="desktopBtn" class="active">
                <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M21,16H3V4H21M21,2H3C1.89,2 1,2.89 1,4V16A2,2 0 0,0 3,18H10V20H8V22H16V20H14V18H21A2,2 0 0,0 23,16V4C23,2.89 22.1,2 21,2Z"></path>
                </svg>
            </button>
            <button id="tabletBtn">
                <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M19,18H5V6H19M21,4H3C1.89,4 1,4.89 1,6V18A2,2 0 0,0 3,20H21A2,2 0 0,0 23,18V6C23,4.89 22.1,4 21,4Z"></path>
                </svg>
            </button>
            <button id="mobileBtn">
                <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M17,19H7V5H17M17,1H7C5.89,1 5,1.89 5,3V21A2,2 0 0,0 7,23H17A2,2 0 0,0 19,21V3C19,1.89 18.1,1 17,1Z"></path>
                </svg>
            </button>
            <span id="tabletBtn" class="" style="flex: 1 1 auto;"></span>
            <button id="dashes">
                <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M15,5H17V3H15M15,21H17V19H15M11,5H13V3H11M19,5H21V3H19M19,9H21V7H19M19,21H21V19H19M19,13H21V11H19M19,17H21V15H19M3,5H5V3H3M3,9H5V7H3M3,13H5V11H3M3,17H5V15H3M3,21H5V19H3M11,21H13V19H11M7,21H9V19H7M7,5H9V3H7V5Z"></path>
                </svg>
            </button>
            <button id="preview">
                <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"></path>
                </svg>
            </button>
            <button id="undo">
                <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M20 13.5C20 17.09 17.09 20 13.5 20H6V18H13.5C16 18 18 16 18 13.5S16 9 13.5 9H7.83L10.91 12.09L9.5 13.5L4 8L9.5 2.5L10.92 3.91L7.83 7H13.5C17.09 7 20 9.91 20 13.5Z"></path>
                </svg>
            </button>
            <button id="redo">
                <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M10.5 18H18V20H10.5C6.91 20 4 17.09 4 13.5S6.91 7 10.5 7H16.17L13.08 3.91L14.5 2.5L20 8L14.5 13.5L13.09 12.09L16.17 9H10.5C8 9 6 11 6 13.5S8 18 10.5 18Z"></path>
                </svg>
            </button>
        </div>
        <div id="canvas-wrap">
            <div id="canvas" class="drop-zone">
            </div>
        </div>
    </div>

    <div id="sidebar">
        <h5>Components</h5>
        <div id="components">
            <div class="draggable" draggable="true" data-element="div">
                <svg fill="#000000" viewBox="0 0 1920 1920" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M0 213.333C0 95.5126 95.5126 0 213.333 0H1706.67C1824.49 0 1920 95.5126 1920 213.333V1706.67C1920 1824.49 1824.49 1920 1706.67 1920H213.333C95.5126 1920 0 1824.49 0 1706.67V213.333ZM213.333 106.667C154.423 106.667 106.667 154.423 106.667 213.333V1706.67C106.667 1765.58 154.423 1813.33 213.333 1813.33H1706.67C1765.58 1813.33 1813.33 1765.58 1813.33 1706.67V213.333C1813.33 154.423 1765.58 106.667 1706.67 106.667H213.333ZM266.667 746.667C237.211 746.667 213.333 722.788 213.333 693.333V373.333C213.333 343.878 237.211 320 266.667 320H1653.33C1682.79 320 1706.67 343.878 1706.67 373.333V693.333C1706.67 722.788 1682.79 746.667 1653.33 746.667H266.667ZM346.667 426.667C331.939 426.667 320 438.606 320 453.333V613.333C320 628.061 331.939 640 346.667 640H1573.33C1588.06 640 1600 628.061 1600 613.333V453.333C1600 438.606 1588.06 426.667 1573.33 426.667H346.667Z"/>
                </svg>
                <div>Header</div>
            </div>
            <div class="draggable" draggable="true" data-element="div">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor" d="M20.5,3L20.34,3.03L15,5.1L9,3L3.36,4.9C3.15,4.97 3,5.15 3,5.38V20.5A0.5,0.5 0 0,0 3.5,21L3.66,20.97L9,18.9L15,21L20.64,19.1C20.85,19.03 21,18.85 21,18.62V3.5A0.5,0.5 0 0,0 20.5,3M10,5.47L14,6.87V18.53L10,17.13V5.47M5,6.46L8,5.45V17.15L5,18.31V6.46M19,17.54L16,18.55V6.86L19,5.7V17.54Z"></path>
                </svg>
                <div>Map</div>
            </div>
        </div>

        <h5>Elements</h5>
        <div id="elements">
            <div class="draggable" draggable="true" data-element="div">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor" d="M2 20h20V4H2v16Zm-1 0V4a1 1 0 0 1 1-1h20a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1Z"></path>
                </svg>
                <div>DIV</div>
            </div>
            <div class="draggable" draggable="true" data-element="p">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor" d="M21,6V8H3V6H21M3,18H12V16H3V18M3,13H21V11H3V13Z"></path>
                </svg>
                <div>Paragraph</div>
            </div>
            <div class="draggable" draggable="true" data-element="h1">
                <svg fill="#000000" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">
                    <path d="M156,56V176a12,12,0,0,1-24,0V128H52v48a12,12,0,0,1-24,0V56a12,12,0,0,1,24,0v48h80V56a12,12,0,0,1,24,0Zm69.66309,41.4209a12.00215,12.00215,0,0,0-12.31739.59277l-24,15.99317a12.00027,12.00027,0,1,0,13.3086,19.97265L208,130.417V200a12,12,0,0,0,24,0V108A11.99922,11.99922,0,0,0,225.66309,97.4209Z"></path>
                </svg>
                <div>H1</div>
            </div>
            <div class="draggable" draggable="true" data-element="h2">
                <svg fill="#000000" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">
                    <path d="M156,56V176a12,12,0,0,1-24,0V128H52v48a12,12,0,0,1-24,0V56a12,12,0,0,1,24,0v48h80V56a12,12,0,0,1,24,0Zm84,131.99414H215.99316l29.51075-39.37891c.11816-.15722.23144-.3164.34179-.47949A36.00408,36.00408,0,1,0,182.834,113.9834,11.9998,11.9998,0,0,0,204.9375,123.333a12.00428,12.00428,0,1,1,21.1543,11.165l-43.56543,58.13379a12.0031,12.0031,0,0,0,9.47168,19.36914c.13379,0,.26562-.002.39843-.00684H240a12,12,0,0,0,0-24Z"/>
                </svg>
                <div>H2</div>
            </div>
            <div class="draggable" draggable="true" data-element="h3">
                <svg fill="#000000" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">
                    <path d="M156,56V176a12,12,0,0,1-24,0V128H52v48a12,12,0,0,1-24,0V56a12,12,0,0,1,24,0v48h80V56a12,12,0,0,1,24,0Zm84.28809,91.7168a40.17538,40.17538,0,0,0-8.78125-6.66016l18.32226-26.18457a11.99971,11.99971,0,0,0-9.832-18.87988h-48a12,12,0,0,0,0,24h24.957l-14.7832,21.12793A11.99971,11.99971,0,0,0,212.00293,160a16,16,0,1,1-11.31348,27.31348,12.0001,12.0001,0,0,0-16.9707,16.9707,39.99987,39.99987,0,0,0,56.56934-56.56738Z"/>
                </svg>
                <div>H3</div>
            </div>
            <div class="draggable" draggable="true" data-element="h4">
                <svg fill="#000000" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">
                    <path d="M156,56V176a12,12,0,0,1-24,0V128H52v48a12,12,0,0,1-24,0V56a12,12,0,0,1,24,0v48h80V56a12,12,0,0,1,24,0Zm80,68a12.0006,12.0006,0,0,0-12,12v20H204.96l18.35449-52.00684a12.00026,12.00026,0,1,0-22.63281-7.98632l-23.998,68A12.00068,12.00068,0,0,0,188,180h36v20a12,12,0,0,0,24,0V136A12.0006,12.0006,0,0,0,236,124Z"/>
                </svg>
                <div>H4</div>
            </div>
            <div class="draggable" draggable="true" data-element="h5">
                <svg fill="#000000" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">
                    <path d="M156,56V176a12,12,0,0,1-24,0V128H52v48a12,12,0,0,1-24,0V56a12,12,0,0,1,24,0v48h80V56a12,12,0,0,1,24,0ZM211.88184,136.002a40.83,40.83,0,0,0-4.48047.24512L210.042,120H240a12,12,0,0,0,0-24H199.835a12,12,0,0,0-11.84473,10.0752l-7.835,48.20214a12.00041,12.00041,0,0,0,20.3125,10.42774,16.2044,16.2044,0,0,1,22.82911-.001,15.91674,15.91674,0,0,1,0,22.5918,16.202,16.202,0,0,1-22.82911.001,11.99943,11.99943,0,1,0-16.93554,17.0039A40.05833,40.05833,0,1,0,211.88184,136.002Z"/>
                </svg>
                <div>H5</div>
            </div>
            <div class="draggable" draggable="true" data-element="h6">
                <svg fill="#000000" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">
                    <path d="M156,56V176a12,12,0,0,1-24,0V128H52v48a12,12,0,0,1-24,0V56a12,12,0,0,1,24,0v48h80V56a12,12,0,0,1,24,0ZM256,168a40,40,0,1,1-74.86768-19.56689c.1045-.19971.2-.40137.3169-.59717l32.249-53.98926a11.99957,11.99957,0,1,1,20.60352,12.30664l-13.24707,22.17725A40.05167,40.05167,0,0,1,256,168Zm-24,0a16,16,0,1,0-16,16A16.01833,16.01833,0,0,0,232,168Z"/>
                </svg>
                <div>H6</div>
            </div>
            <div class="draggable" draggable="true" data-element="img">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor" d="M21,3H3C2,3 1,4 1,5V19A2,2 0 0,0 3,21H21C22,21 23,20 23,19V5C23,4 22,3 21,3M5,17L8.5,12.5L11,15.5L14.5,11L19,17H5Z"></path>
                </svg>
                <div>Image</div>
            </div>
        </div>
    </div>
</main>

<footer>
<iframe src="/layout/footer.html" onload="this.insertAdjacentHTML('afterend', (this.contentDocument.body||this.contentDocument).innerHTML);this.remove()"></iframe>
</footer>

<script>
const draggables = document.querySelectorAll('.draggable');
const canvas = document.getElementById('canvas');
const body = document.body;
let dragType = null;
let draggedElement = null;
let marker = document.createElement('div');
marker.className = 'insert-marker';

draggables.forEach(el => {
    el.addEventListener('dragstart', e => {
        dragType = e.target.dataset.element;
        draggedElement = null;
    });
});

function makeReorderable(el) {
    el.draggable = true;
    el.addEventListener('dragstart', e => {
        dragType = null;
        draggedElement = el;
        setTimeout(() => el.style.opacity = '0.3', 0);
    });
    el.addEventListener('dragend', e => {
        el.style.opacity = '1';
    });
}

function makeRemovable(el) {
    const removeBtn = document.createElement('button');
    removeBtn.textContent = '×';
    removeBtn.className = 'remove-btn';
    removeBtn.addEventListener('click', e => {
        e.stopPropagation();
        el.remove();
    });
    el.appendChild(removeBtn);
}

function makeDroppable(zone) {
    zone.addEventListener('dragover', e => {
        e.preventDefault();
        const target = e.target.closest('.element, #canvas');
        if (!target || !canvas.contains(target)) return; // restrict drop area
        target.classList.add('hover');

        const rect = target.getBoundingClientRect();
        const before = e.clientY < rect.top + rect.height / 3;
        const after = e.clientY > rect.bottom - rect.height / 3;

        if (!before && !after && target.classList.contains('element')) {
            target.appendChild(marker);
        } else {
            if (before) target.parentNode.insertBefore(marker, target);
            else target.parentNode.insertBefore(marker, target.nextSibling);
        }
    });

    zone.addEventListener('dragleave', e => {
        e.target.classList.remove('hover');
    });

    zone.addEventListener('drop', e => {
        e.preventDefault();

        let newEl;
        if (draggedElement) {
            newEl = draggedElement;
        } else if (dragType) {
            newEl = document.createElement(dragType);
            newEl.className = 'element drop-zone';
            newEl.setAttribute('contenteditable', dragType !== 'img');
            newEl.innerHTML = dragType === 'img' ? '<img src="https://via.placeholder.com/150" alt="Image" style="max-width:100%;" />' : `${dragType} Element`;
            makeDroppable(newEl);
            makeReorderable(newEl);
            makeRemovable(newEl);
        }

        if (marker.parentNode && canvas.contains(marker.parentNode)) {
            marker.parentNode.insertBefore(newEl, marker);
            marker.remove();
        } else {
            canvas.appendChild(newEl);
        }

        dragType = null;
        draggedElement = null;
    });
}

makeDroppable(canvas);

// Device width toggles
const desktopBtn = document.getElementById('desktopBtn');
const tabletBtn  = document.getElementById('tabletBtn');
const mobileBtn  = document.getElementById('mobileBtn');

function setMode(mode) {
    body.className = mode;
    document.querySelectorAll('#toolbar button').forEach(btn => btn.classList.remove('active'));
    if (mode === 'desktop') desktopBtn.classList.add('active');
    if (mode === 'tablet')   tabletBtn.classList.add('active');
    if (mode === 'mobile')   mobileBtn.classList.add('active');
}

desktopBtn.addEventListener('click', () => setMode('desktop'));
 tabletBtn.addEventListener('click', () => setMode('tablet'));
 mobileBtn.addEventListener('click', () => setMode('mobile'));
</script>

</body>
</html>