<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/layout/css/cosmuic.css">
<link rel="stylesheet" href="/layout/css/styles.css">
<title>Mystic's Web: Page Builder</title>
<style>

/* Base Styles */
:root {
    --primary-color: #667eea;
    --primary-dark: #5a67d8;
    --secondary-color: #764ba2;
    --accent-color: #ff7e5f;
    --text-primary: #2d3748;
    --text-secondary: #4a5568;
    --bg-primary: #f7fafc;
    --bg-secondary: #edf2f7;
    --border-color: #e2e8f0;
    --success-color: #48bb78;
    --warning-color: #ed8936;
    --danger-color: #f56565;
    --white: #ffffff;
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
    --rounded-sm: 0.25rem;
    --rounded-md: 0.5rem;
    --rounded-lg: 0.75rem;
    --transition: all 0.2s ease;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: var(--font, "IBM Plex Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol");
    color: var(--text-primary);
    background-color: var(--bg-primary);
    overflow: hidden;
}

#app {
    all: unset;
    display: flex;
    flex-direction: column;
    width: 100vw;
    height: calc(100vh - 64px);
    overflow: hidden;
    margin-top: 64px;
    position: absolute;
}

#app header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1.5rem;
    background-color: var(--white);
    box-shadow: var(--shadow-sm);
    z-index: 10;
}

#app main {
    display: flex;
    flex: 1;
    overflow: hidden;
    max-width: 100vw;
    padding: 0;
}

#app aside {
    width: 240px;
    background-color: var(--white);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
}

#app #display {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background-color: var(--white);
    border-right: 1px solid var(--border-color);
}

#app #details {
    width: 275px;
    border-right: none;
    display: flex;
    flex-direction: column;
}

#app #details #add {
    display: flex;
    flex: 1 1 auto;
    overflow: auto;
    flex-direction: column;
}

#app nav ul {
    all: unset;
    list-style: none;
}

#app nav li {
    all: unset;
    margin-bottom: 0.25rem;
}

#app nav a {
    display: flex;
    align-items: center;
    padding: 0.75rem 1.5rem;
    color: var(--text-secondary);
    text-decoration: none;
    transition: var(--transition);
    border-radius: var(--rounded-sm);
}

#app nav li.active a {
    background-color: rgba(102, 126, 234, 0.1);
    color: var(--primary-color);
    font-weight: 500;
}

#filemgr {
    border-top: 1px solid var(--border-color);
    padding: 0 1.5rem;
    font-size: 0.875rem;
    display: flex;
    flex: 1 1 auto;
    overflow: auto;
}

.toolbar {
    width: 100%;
    padding: 10px;
    display: flex;
    flex-direction: row;
    gap: 6px;
    border-bottom: 1px solid var(--border-color);
    min-height: 48px;
    max-height: 48px;
}

.toolbar button {
    padding: 3px;
    border: 1px solid #aaa;
    background: #fff;
    color: black;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.2s;
    line-height: 1rem;
    margin: 0;
    max-width: 26px;
    min-width: 26px;
    height: 26px;
}

.toolbar button > svg {
    width: 18px;
    height: 18px;
}

.toolbar button.active {
    background: #007bff;
    color: white;
    border-color: #007bff;
}

#canvas-wrap {
    flex: 1;
    background: #eee;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    overflow: auto;
    padding: 10px;
    box-sizing: border-box;
}

/* iframe canvas */
#canvas-frame {
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 8px;
    transition: width 0.3s, height 0.3s;
    width: 1200px;
    height: calc(100vh - 140px);
    box-sizing: border-box;
}

#canvas-wrap.preview {
    position: absolute;
    top: -64px;
    left: 0;
    right: 0;
    bottom: 0;
    padding: 0;
    z-index: 20000;
}

#canvas-wrap.preview > #canvas-frame {
    width: 100%;
    height: 100%;
    border-radius: 0;
    border: 0;
}

/* device widths - these apply to the FRAME so the inner page appears narrower */
.desktop #canvas-frame { width: 1200px; }
.tablet  #canvas-frame { width: 768px; }
.mobile  #canvas-frame { width: 375px; }

.draggable {
    display: block;
    padding: 8px;
    background: #ddd;
    margin-bottom: 8px;
    cursor: grab;
    border-radius: 4px;
    text-align: center;

    user-select: none;
    width: 45%;
    min-width: 45px;
    padding: .5em;
    box-sizing: border-box;
    /* min-height: 90px; */
    cursor: all-scroll;
    font-size: 11px;
    font-weight: lighter;
    text-align: center;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    border: 1px solid rgba(0, 0, 0, .2);
    border-radius: 3px;
    margin: 10px 2.5% 5px;
    box-shadow: 0 1px 0 0 rgba(0, 0, 0, .15);
    transition: all .2s ease 0s;
    transition-property: box-shadow, color;
}

.draggable > svg {
    width: 24px;
    height: 24px;
}

.draggable > div {
    display: flex;
    flex: 1 1 0;
    padding-left: .5rem;
    align-items: center;
}

/* These are kept for preview in the parent (used by new elements inside the iframe too, via injected styles) */
.drop-zone {
    min-height: 20px;
    border: 1px dashed #ccc;
    padding: 5px;
    margin: 5px 0;
    border-radius: 5px;
    transition: background 0.2s, border-color 0.2s;
}

.drop-zone.hover {
    border-color: #666;
    background: #f8f8f8;
}

.element {
    padding: 10px;
    background: #e8e8ff;
    margin: 5px 0;
    border-radius: 5px;
    position: relative;
    cursor: grab;
    display: block;
}

.element button.remove-btn {
    all: unset;
    position: absolute;
    top: 4px;
    right: 4px;
    background: #ff4d4d;
    color: white;
    border: none;
    border-radius: 3px;
    font-size: 12px;
    padding: 2px 5px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.2s;
}

.element:hover button.remove-btn {
    opacity: 1;
}

.insert-marker {
    height: 4px;
    background: #007bff;
    border-radius: 2px;
    margin: 2px 0;
    transition: opacity 0.2s;
}

.placeholder {
    border: 2px dashed #007bff;
    margin: 5px 0;
    height: 20px;
    border-radius: 5px;
    /* background: repeating-linear-gradient(45deg, #007bff22, #007bff22 10px, #fff 10px, #fff 20px); */
}

#components, #elements {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    /* overflow-y: auto; */
    overflow: hidden auto;
}

#preview-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    max-width: calc(100vw - 200px);
}

.file_tree {
  width: 200px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
.file_tree input[type=radio],
.file_tree input[type=checkbox] {
  width: 0;
  height: 0;
  opacity: 0;
  position: absolute;
  margin: 0;
}
.file_tree label {
  display: block;
  width: 100%;
  font-size: 14px;
  height: 30px;
  line-height: 30px;
  padding: 0 8px;
  cursor: pointer;
  white-space: nowrap;
}
.file_tree label:hover {
  color: #a4d3ff;
}
.file_tree .dir_wrapper {
  display: none;
  padding-left: 28px;
}
.file_tree .dir_wrapper label {
  padding-left: 0;
}
.file_tree input[type=checkbox] + label {
  padding-left: 30px;
}
.file_tree input[type=checkbox] + label:hover {
  color: #a4d3ff;
}
.file_tree input[type=radio]:checked + label {
  color: #5298fc;
}
.file_tree input[type=checkbox]:checked + label + .dir_wrapper {
  display: block;
}

.file_tree input[type=checkbox] + label {
  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAABQCAYAAABxs9dPAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjc0Q0FDNEY5NDFGQjExRTQ4MEQ4ODY5MEFBODE4RDk2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjc0Q0FDNEZBNDFGQjExRTQ4MEQ4ODY5MEFBODE4RDk2Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NzRDQUM0Rjc0MUZCMTFFNDgwRDg4NjkwQUE4MThEOTYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NzRDQUM0Rjg0MUZCMTFFNDgwRDg4NjkwQUE4MThEOTYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7T+9ssAAABJ0lEQVR42uzZMQrCMBgF4FbE0UFPILg5qdAbCA7q5qK7p3Bw8BK6u4giboKCJxDB1cFdsOjapb5ACyoiNG3pj30P3hj4SBOaEPP6cFwjWG5oAz0aMSSjMaaIbtGqFJCP2qE1KSCVgjdTkaKyIccr1B49SwGp5NF6HCAbvRjJpOTN9htog/YTAs3QXthFbUja9gQRRBBBBBFEEEEEpQVkalyl0zVD6tYxlfbJZK0h13W5ywgiiCCCCCKIIIII+nGmnp/u4g75k4Bj1IviCHXiAg00xlXQbhwo3TXUQRdoTtKibqPLqFFhH/Ba6BpdSQGpNL3+793ej3pRHCbkGPuz/PnmekgIZPNfRhBBBBFEEEEEEURQ8DO1pXGtjirWN1DZKz/Za54CDABbrytKn66XKwAAAABJRU5ErkJggg==);
  background-size: 18px 40px;
  background-position: top 7px left 6px;
  background-repeat: no-repeat;
  vertical-align: middle;
}
.file_tree input[type=checkbox] + label:hover {
  background-position: top -18px left 6px;
}

</style>
</head>
<body class="desktop">

<header>
<iframe src="/layout/header.html" onload="this.insertAdjacentHTML('afterend', (this.contentDocument.body||this.contentDocument).innerHTML);this.remove()"></iframe>
</header>

<div id="app">
    <!-- <header>Text</header> -->
    <main>
        <aside>
            <div class="toolbar">Portions</div>
            <nav>
                <ul>
                    <li><a href="#"><i></i> Media Library</a></li>
                    <li><a href="#"><i></i> Components</a></li>
                    <li><a href="#"><i></i> Site Template</a></li>
                    <li class="active"><a href="#"><i></i> Pages</a></li>
                </ul>
            </nav>
            <div id="filemgr">
                <!-- Start File List -->
                <div class="file_tree">
                    <input type="checkbox" id="f_folder"><label for="f_folder">Folder</label>
                    <div class="dir_wrapper">
                        <input type="checkbox" id="f_wehave"><label for="f_wehave">We Have</label>
                        <div class="dir_wrapper">
                        <input type="checkbox" id="f_togo"><label for="f_togo">To Go</label>
                        <div class="dir_wrapper">
                            <input type="radio" name="hosted_files" id="f_deeper_js" value="Deeper.js"><label for="f_deeper_js">Deeper.js</label>
                            <input type="radio" name="hosted_files" id="f_fileception_js" value="Fileception.js"><label for="f_fileception_js">Fileception.js</label>
                        </div>
                        </div>
                    </div>
                    <input type="checkbox" id="f_anotherfolder"><label for="f_anotherfolder">Another Folder</label>
                    <div class="dir_wrapper">
                        <input type="radio" name="hosted_files" id="f_withafile_js" value="with_a_file.js"><label for="f_withafile_js">with_a_file.js</label>
                    </div>
                    <input type="radio" name="hosted_files" id="f_main_js" value="main.js" checked><label for="f_main_js">main.js</label>
                    <input type="radio" name="hosted_files" id="f_globals_js" value="globals.js"><label for="f_globals_js">globals.js</label>
                    <input type="radio" name="hosted_files" id="f_filler_js" value="filler.js"><label for="f_filler_js">filler.js</label>
                    <input type="radio" name="hosted_files" id="f_index_html" value="index.html"><label for="f_index_html">index.html</label>
                </div>
                <!-- End File -->
            </div>
        </aside>
        <div id="display">
            <div id="toolbar" class="toolbar">
                <button id="desktopBtn" class="active">
                    <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M21,16H3V4H21M21,2H3C1.89,2 1,2.89 1,4V16A2,2 0 0,0 3,18H10V20H8V22H16V20H14V18H21A2,2 0 0,0 23,16V4C23,2.89 22.1,2 21,2Z"></path>
                    </svg>
                </button>
                <button id="tabletBtn">
                    <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19,18H5V6H19M21,4H3C1.89,4 1,4.89 1,6V18A2,2 0 0,0 3,20H21A2,2 0 0,0 23,18V6C23,4.89 22.1,4 21,4Z"></path>
                    </svg>
                </button>
                <button id="mobileBtn">
                    <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M17,19H7V5H17M17,1H7C5.89,1 5,1.89 5,3V21A2,2 0 0,0 7,23H17A2,2 0 0,0 19,21V3C19,1.89 18.1,1 17,1Z"></path>
                    </svg>
                </button>
                <span id="tabletBtn" class="" style="flex: 1 1 auto;"></span>
                <button id="dashes">
                    <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M15,5H17V3H15M15,21H17V19H15M11,5H13V3H11M19,5H21V3H19M19,9H21V7H19M19,21H21V19H19M19,13H21V11H19M19,17H21V15H19M3,5H5V3H3M3,9H5V7H3M3,13H5V11H3M3,17H5V15H3M3,21H5V19H3M11,21H13V19H11M7,21H9V19H7M7,5H9V3H7V5Z"></path>
                    </svg>
                </button>
                <button id="preview">
                    <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"></path>
                    </svg>
                </button>
                <button id="undo">
                    <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M20 13.5C20 17.09 17.09 20 13.5 20H6V18H13.5C16 18 18 16 18 13.5S16 9 13.5 9H7.83L10.91 12.09L9.5 13.5L4 8L9.5 2.5L10.92 3.91L7.83 7H13.5C17.09 7 20 9.91 20 13.5Z"></path>
                    </svg>
                </button>
                <button id="redo">
                    <svg style="display: block; max-width:22px" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M10.5 18H18V20H10.5C6.91 20 4 17.09 4 13.5S6.91 7 10.5 7H16.17L13.08 3.91L14.5 2.5L20 8L14.5 13.5L13.09 12.09L16.17 9H10.5C8 9 6 11 6 13.5S8 18 10.5 18Z"></path>
                    </svg>
                </button>
            </div>
            <div id="canvas-wrap" class="edit">
                <iframe id="canvas-frame" src="./blank.html" title="Canvas"></iframe>
            </div>
        </div>
        <div id="details">
            <div class="toolbar" style="justify-content: flex-end;">
                <button id="add">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12ZM11 18V17V13H7H6V11H7H11V7V6H13V7V11H17H18V13H17H13V17V18H11Z" fill="#222222"/>
                    </svg>
                </button>
                <button id="info">
                    <svg fill="#000000" viewBox="0 -8 528 528" xmlns="http://www.w3.org/2000/svg" >
                        <path d="M264 456Q210 456 164 429 118 402 91 356 64 310 64 256 64 202 91 156 118 110 164 83 210 56 264 56 318 56 364 83 410 110 437 156 464 202 464 256 464 310 437 356 410 402 364 429 318 456 264 456ZM296 208L296 144 232 144 232 208 296 208ZM296 368L296 240 232 240 232 368 296 368Z" />
                    </svg>
                </button>
            </div>
            <div id="add">
                <h5>Components</h5>
                <div id="components">
                    <div class="draggable" draggable="true" data-component="header">
                        <svg fill="#000000" viewBox="0 0 1920 1920" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M0 213.333C0 95.5126 95.5126 0 213.333 0H1706.67C1824.49 0 1920 95.5126 1920 213.333V1706.67C1920 1824.49 1824.49 1920 1706.67 1920H213.333C95.5126 1920 0 1824.49 0 1706.67V213.333ZM213.333 106.667C154.423 106.667 106.667 154.423 106.667 213.333V1706.67C106.667 1765.58 154.423 1813.33 213.333 1813.33H1706.67C1765.58 1813.33 1813.33 1765.58 1813.33 1706.67V213.333C1813.33 154.423 1765.58 106.667 1706.67 106.667H213.333ZM266.667 746.667C237.211 746.667 213.333 722.788 213.333 693.333V373.333C213.333 343.878 237.211 320 266.667 320H1653.33C1682.79 320 1706.67 343.878 1706.67 373.333V693.333C1706.67 722.788 1682.79 746.667 1653.33 746.667H266.667ZM346.667 426.667C331.939 426.667 320 438.606 320 453.333V613.333C320 628.061 331.939 640 346.667 640H1573.33C1588.06 640 1600 628.061 1600 613.333V453.333C1600 438.606 1588.06 426.667 1573.33 426.667H346.667Z"></path>
                        </svg>
                        <div>Header</div>
                    </div>
                    <div class="draggable" draggable="true" data-component="map">
                        <svg viewBox="0 0 24 24">
                            <path fill="currentColor" d="M20.5,3L20.34,3.03L15,5.1L9,3L3.36,4.9C3.15,4.97 3,5.15 3,5.38V20.5A0.5,0.5 0 0,0 3.5,21L3.66,20.97L9,18.9L15,21L20.64,19.1C20.85,19.03 21,18.85 21,18.62V3.5A0.5,0.5 0 0,0 20.5,3M10,5.47L14,6.87V18.53L10,17.13V5.47M5,6.46L8,5.45V17.15L5,18.31V6.46M19,17.54L16,18.55V6.86L19,5.7V17.54Z"></path>
                        </svg>
                        <div>Map</div>
                    </div>
                </div>

                <h5>Elements</h5>
                <div id="elements">
                    <div class="draggable" draggable="true" data-element="div">
                        <svg viewBox="0 0 24 24">
                            <path fill="currentColor" d="M2 20h20V4H2v16Zm-1 0V4a1 1 0 0 1 1-1h20a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1Z"></path>
                        </svg>
                        <div>DIV</div>
                    </div>
                    <div class="draggable" draggable="true" data-element="p">
                        <svg viewBox="0 0 24 24">
                            <path fill="currentColor" d="M21,6V8H3V6H21M3,18H12V16H3V18M3,13H21V11H3V13Z"></path>
                        </svg>
                        <div>Paragraph</div>
                    </div>
                    <div class="draggable" draggable="true" data-element="h1">
                        <svg fill="#000000" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">
                            <path d="M156,56V176a12,12,0,0,1-24,0V128H52v48a12,12,0,0,1-24,0V56a12,12,0,0,1,24,0v48h80V56a12,12,0,0,1,24,0Zm69.66309,41.4209a12.00215,12.00215,0,0,0-12.31739.59277l-24,15.99317a12.00027,12.00027,0,1,0,13.3086,19.97265L208,130.417V200a12,12,0,0,0,24,0V108A11.99922,11.99922,0,0,0,225.66309,97.4209Z"></path>
                        </svg>
                        <div>H1</div>
                    </div>
                    <div class="draggable" draggable="true" data-element="h2">
                        <svg fill="#000000" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">
                            <path d="M156,56V176a12,12,0,0,1-24,0V128H52v48a12,12,0,0,1-24,0V56a12,12,0,0,1,24,0v48h80V56a12,12,0,0,1,24,0Zm84,131.99414H215.99316l29.51075-39.37891c.11816-.15722.23144-.3164.34179-.47949A36.00408,36.00408,0,1,0,182.834,113.9834,11.9998,11.9998,0,0,0,204.9375,123.333a12.00428,12.00428,0,1,1,21.1543,11.165l-43.56543,58.13379a12.0031,12.0031,0,0,0,9.47168,19.36914c.13379,0,.26562-.002.39843-.00684H240a12,12,0,0,0,0-24Z"></path>
                        </svg>
                        <div>H2</div>
                    </div>
                    <div class="draggable" draggable="true" data-element="h3">
                        <svg fill="#000000" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">
                            <path d="M156,56V176a12,12,0,0,1-24,0V128H52v48a12,12,0,0,1-24,0V56a12,12,0,0,1,24,0v48h80V56a12,12,0,0,1,24,0Zm84.28809,91.7168a40.17538,40.17538,0,0,0-8.78125-6.66016l18.32226-26.18457a11.99971,11.99971,0,0,0-9.832-18.87988h-48a12,12,0,0,0,0,24h24.957l-14.7832,21.12793A11.99971,11.99971,0,0,0,212.00293,160a16,16,0,1,1-11.31348,27.31348,12.0001,12.0001,0,0,0-16.9707,16.9707,39.99987,39.99987,0,0,0,56.56934-56.56738Z"></path>
                        </svg>
                        <div>H3</div>
                    </div>
                    <div class="draggable" draggable="true" data-element="h4">
                        <svg fill="#000000" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">
                            <path d="M156,56V176a12,12,0,0,1-24,0V128H52v48a12,12,0,0,1-24,0V56a12,12,0,0,1,24,0v48h80V56a12,12,0,0,1,24,0Zm80,68a12.0006,12.0006,0,0,0-12,12v20H204.96l18.35449-52.00684a12.00026,12.00026,0,1,0-22.63281-7.98632l-23.998,68A12.00068,12.00068,0,0,0,188,180h36v20a12,12,0,0,0,24,0V136A12.0006,12.0006,0,0,0,236,124Z"></path>
                        </svg>
                        <div>H4</div>
                    </div>
                    <div class="draggable" draggable="true" data-element="h5">
                        <svg fill="#000000" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">
                            <path d="M156,56V176a12,12,0,0,1-24,0V128H52v48a12,12,0,0,1-24,0V56a12,12,0,0,1,24,0v48h80V56a12,12,0,0,1,24,0ZM211.88184,136.002a40.83,40.83,0,0,0-4.48047.24512L210.042,120H240a12,12,0,0,0,0-24H199.835a12,12,0,0,0-11.84473,10.0752l-7.835,48.20214a12.00041,12.00041,0,0,0,20.3125,10.42774,16.2044,16.2044,0,0,1,22.82911-.001,15.91674,15.91674,0,0,1,0,22.5918,16.202,16.202,0,0,1-22.82911.001,11.99943,11.99943,0,1,0-16.93554,17.0039A40.05833,40.05833,0,1,0,211.88184,136.002Z"></path>
                        </svg>
                        <div>H5</div>
                    </div>
                    <div class="draggable" draggable="true" data-element="h6">
                        <svg fill="#000000" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">
                            <path d="M156,56V176a12,12,0,0,1-24,0V128H52v48a12,12,0,0,1-24,0V56a12,12,0,0,1,24,0v48h80V56a12,12,0,0,1,24,0ZM256,168a40,40,0,1,1-74.86768-19.56689c.1045-.19971.2-.40137.3169-.59717l32.249-53.98926a11.99957,11.99957,0,1,1,20.60352,12.30664l-13.24707,22.17725A40.05167,40.05167,0,0,1,256,168Zm-24,0a16,16,0,1,0-16,16A16.01833,16.01833,0,0,0,232,168Z"></path>
                        </svg>
                        <div>H6</div>
                    </div>
                    <div class="draggable" draggable="true" data-element="img">
                        <svg viewBox="0 0 24 24">
                            <path fill="currentColor" d="M21,3H3C2,3 1,4 1,5V19A2,2 0 0,0 3,21H21C22,21 23,20 23,19V5C23,4 22,3 21,3M5,17L8.5,12.5L11,15.5L14.5,11L19,17H5Z"></path>
                        </svg>
                        <div>Image</div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<footer>
<iframe src="/layout/footer.html" onload="this.insertAdjacentHTML('afterend', (this.contentDocument.body||this.contentDocument).innerHTML);this.remove()"></iframe>
</footer>

<script>

/* Parent-side elements */
const draggables = document.querySelectorAll('.draggable');
const iframe = document.getElementById('canvas-frame');
const body = document.body;

/* Drag state (shared): */
let dragType = null;          // string like 'div', 'p', etc. (from sidebar)
let dragComponent = null;     // string like 'header' (from sidebar)
let draggedElement = null;    // if reordering an existing element (may reference element in iframe doc)
let draggedFromDoc = null;    // ownerDocument of draggedElement (helps with cross-doc)

function parentDragStartHandler(e) {
    // ensure some dataTransfer payload so iframe will accept drag events (browser quirk)
    try {
        e.dataTransfer.setData('text/plain', e.target.dataset.element || e.target.dataset.component || '');
    } catch (err) {
        // ignore if browser disallows
    }
    e.dataTransfer.effectAllowed = 'copy';
    dragType = e.target.dataset.element || null;
    dragComponent = e.target.dataset.component || null;
    draggedElement = null;
    draggedFromDoc = null;
}

/* set dataTransfer for all sidebar draggables */
draggables.forEach(el => {
    el.addEventListener('dragstart', parentDragStartHandler);
});

/* Utility: create a removable button inside the provided document */
function makeRemovable(el, doc) {
    const removeBtn = doc.createElement('button');
    removeBtn.textContent = '×';
    removeBtn.className = 'remove-btn';
    removeBtn.addEventListener('click', e => {
        e.stopPropagation();
        el.remove();
    });
    el.appendChild(removeBtn);
}

/* Utility: make element reorderable (drag within its ownerDocument) */
function makeReorderable(el) {
    el.draggable = true;
    el.addEventListener('dragstart', e => {
        // when dragging a node from inside iframe, we record it
        dragType = null;
        dragComponent = null;
        draggedElement = el;
        draggedFromDoc = el.ownerDocument;
        // we don't set dataTransfer (sidebar does), but to be safe:
        try { e.dataTransfer.setData('text/plain', 'internal'); } catch (err) {}
        setTimeout(() => el.style.opacity = '0.3', 0);
    });
    el.addEventListener('dragend', e => {
        el.style.opacity = '1';
        draggedElement = null;
        draggedFromDoc = null;
    });
}

/* Create an insert marker element inside a given document */
function createMarker(doc) {
    const m = doc.createElement('div');
    m.className = 'insert-marker';
    return m;
}

/* Inject minimal styles into iframe doc so elements look right and marker works */
function injectIframeStyles(doc) {
    // avoid double-inject
    if (doc.getElementById('builder-injected-styles')) return;
    const style = doc.createElement('style');
    style.id = 'builder-injected-styles';
    style.textContent = `
        .element { border: 1px dashed lightgray !important; position: relative; cursor: grab; }
        .drop-zone { min-height: 20px; border: 1px dashed #ccc; padding: 5px; margin: 5px 0; border-radius: 5px; transition: background 0.2s, border-color 0.2s; }
        .drop-zone.hover { border-color: #666; background: #f8f8f8; }
        .remove-btn { all: unset; position: absolute; top: 4px; right: 4px; background: #ff4d4d; color: white; border-radius: 3px; font-size: 12px; padding: 2px 5px; cursor: pointer; opacity: 0; transition: opacity .2s; line-height: 1rem;}
        .element:hover .remove-btn { opacity: 1; }
        .insert-marker { height: 4px; background: #007bff; border-radius: 2px; margin: 2px 0; transition: opacity 0.2s; }
    `;
    doc.head.appendChild(style);
}

/* Setup iframe drop behaviors when the iframe is loaded/ready */
function setupIframeCanvas() {
    const doc = iframe.contentDocument || iframe.contentWindow.document;
    if (!doc) return;

    // ensure we can edit the body
    doc.body.contentEditable = 'true';

    // inject styles for marker, element etc.
    injectIframeStyles(doc);

    // create one marker per iframe document
    const marker = createMarker(doc);

    // make sure existing children of body are droppable/reorderable if any
    Array.from(doc.body.children).forEach(child => {
        // only attach behavior to elements we create or to elements that look like drop-able
        if (!child.classList.contains('element')) {
            // leave as-is, but we can wrap or mark as drop-zone if needed
        }
        // if element already created by user and is editable, make it behave
        if (child.classList.contains('element')) {
            makeReorderable(child);
            makeRemovable(child, doc);
        }
    });

    /* Helper: determine valid target for inserting: element or body */
    function findTarget(el) {
        // allow dropping on elements or body
        return el.closest('.element') || el.closest('body');
    }

    /* dragover on iframe document: show marker placement */
    doc.addEventListener('dragover', e => {
        e.preventDefault(); // allow drop
        const target = findTarget(e.target);
        if (!target) return;

        // remove previous marker placements
        // (marker will be inserted into the DOM below)
        // compute insertion point based on pointer Y
        const rect = target.getBoundingClientRect();
        const before = e.clientY < rect.top + rect.height / 3;
        const after  = e.clientY > rect.bottom - rect.height / 3;

        // remove marker if already in different place
        if (marker.parentNode && marker.parentNode !== target && !target.contains(marker)) {
            marker.remove();
        }

        // if target is body -> append/prepend appropriately
        if (target === doc.body) {
            // if body has children, decide where to place relative to last child under pointer
            const children = Array.from(doc.body.children);
            // find a child under the pointer, fallback to append
            let placed = false;
            for (const child of children) {
                const r = child.getBoundingClientRect();
                if (e.clientY < r.top + r.height/2) {
                    child.parentNode.insertBefore(marker, child);
                    placed = true;
                    break;
                }
            }
            if (!placed) doc.body.appendChild(marker);
        } else {
            // target is an element
            if (!before && !after) {
                // drop *into* the element
                target.appendChild(marker);
            } else if (before) {
                target.parentNode.insertBefore(marker, target);
            } else {
                target.parentNode.insertBefore(marker, target.nextSibling);
            }
        }
    });

    /* dragenter and dragleave for hover class */
    doc.addEventListener('dragenter', e => {
        const t = findTarget(e.target);
        if (t && t.classList) t.classList.add('hover');
    });
    doc.addEventListener('dragleave', e => {
        const t = findTarget(e.target);
        if (t && t.classList) t.classList.remove('hover');
    });

    /* drop handler in iframe doc */
    doc.addEventListener('drop', async e => {
        e.preventDefault();

        const target = findTarget(e.target) || doc.body;
        let newEl = null;

        // CASE A: reordering / moving an existing element dragged inside the iframe
        if (draggedElement && draggedFromDoc === doc) {
            // simple move
            newEl = draggedElement;
        }
        // CASE B: dragging an existing element FROM DIFFERENT DOC (rare) - import if possible
        else if (draggedElement && draggedFromDoc !== doc) {
            // import node (deep)
            try {
                newEl = doc.importNode(draggedElement, true);
            } catch (err) {
                newEl = draggedElement.cloneNode(true);
            }
        }
        // CASE C: sidebar element types (element tag names)
        else if (dragType) {
            newEl = doc.createElement(dragType);
            newEl.className = 'element';
            if (dragType !== 'img') newEl.setAttribute('contenteditable', 'true');
            newEl.innerHTML = dragType === 'img'
                ? '<img src="https://via.placeholder.com/150" alt="Image" style="max-width:100%;" />'
                : `${dragType} Element`;
            // attach behaviors for future reordering/removal
            makeReorderable(newEl);
            makeRemovable(newEl, doc);
        }
        // CASE D: components (load via fetch in parent, inject into iframe doc)
        else if (dragComponent) {
            const filePath = `./components/${dragComponent}.html`;
            try {
                // // fetch in parent context (same-origin); then create element in iframe doc
                // const res = await fetch(filePath);
                // const html = await res.text();
                // newEl = doc.createElement('div');
                // newEl.className = 'element';
                // newEl.innerHTML = html;
                // makeReorderable(newEl);
                // makeRemovable(newEl, doc);

                const res = await fetch(filePath);
                const html = await res.text();

                const temp = document.createElement('template');
                temp.innerHTML = html.trim();
                const firstEl = temp.content.firstElementChild;

                if (!firstEl) {
                    console.error('Component file has no root element:', filePath);
                    dragType = dragComponent = draggedElement = draggedFromDoc = null;
                    return;
                }

                newEl = firstEl;
                newEl.classList.add('element');  // add your builder class
                makeReorderable(newEl);
                makeRemovable(newEl, doc);
            } catch (err) {
                console.error('Failed to load component', filePath, err);
                dragType = dragComponent = draggedElement = draggedFromDoc = null;
                return;
            }
        }

        // Insert newEl at marker position if marker present in the same document
        if (newEl) {
            if (marker.parentNode && doc.body.contains(marker.parentNode)) {
                marker.parentNode.insertBefore(newEl, marker);
                marker.remove();
            } else {
                doc.body.appendChild(newEl);
            }
        }

        // reset drag state
        dragType = null;
        dragComponent = null;
        draggedElement = null;
        draggedFromDoc = null;
    }); /* end drop */

    // Also: allow selecting text/input inside iframe (contentEditable already set)
}

/* When iframe finishes loading, initialize its drop listeners */
iframe.addEventListener('load', () => {
    try {
        setupIframeCanvas();
    } catch (err) {
        console.error('Error setting up iframe canvas', err);
    }
});

/* Device width toggles */
const desktopBtn = document.getElementById('desktopBtn');
const tabletBtn  = document.getElementById('tabletBtn');
const mobileBtn  = document.getElementById('mobileBtn');

function setMode(mode) {
    body.className = mode;
    document.querySelectorAll('#toolbar button').forEach(btn => btn.classList.remove('active'));
    if (mode === 'desktop') desktopBtn.classList.add('active');
    if (mode === 'tablet')   tabletBtn.classList.add('active');
    if (mode === 'mobile')   mobileBtn.classList.add('active');
    // The iframe frame width is controlled by CSS rules on the body class (see CSS above)
}

desktopBtn.addEventListener('click', () => setMode('desktop'));
tabletBtn.addEventListener('click', () => setMode('tablet'));
mobileBtn.addEventListener('click', () => setMode('mobile'));

</script>
</body>
</html>